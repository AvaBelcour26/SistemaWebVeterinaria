<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${titulo} + ' - Sistema Veterinario'">Formulario de Mascota - Sistema Veterinario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        .form-container {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
<!-- Incluir navbar desde fragmento -->
<div th:replace="fragments/navbar :: navbar"></div>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0" th:text="${titulo}">Formulario de Mascota</h3>
                </div>
                <div class="card-body">
                    <form th:action="@{/mascotas/guardar}" th:object="${mascota}" method="post">
                        <input type="hidden" th:field="*{idMascota}" />

                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre de la mascota</label>
                            <input type="text" class="form-control" id="nombre" th:field="*{nombre}" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}">Error en el nombre</div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="especie" class="form-label">Especie</label>
                                <select class="form-select" id="especie" th:field="*{especie}" required>
                                    <option value="">-- Seleccione especie --</option>
                                    <option value="Perro">Perro</option>
                                    <option value="Gato">Gato</option>
                                    <option value="Ave">Ave</option>
                                    <option value="Conejo">Conejo</option>
                                    <option value="Roedor">Roedor</option>
                                    <option value="Reptil">Reptil</option>
                                    <option value="Otro">Otro</option>
                                </select>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('especie')}" th:errors="*{especie}">Error en la especie</div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="raza" class="form-label">Raza</label>
                                <input type="text" class="form-control" id="raza" th:field="*{raza}">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('raza')}" th:errors="*{raza}">Error en la raza</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="fechaNacimientoStr" class="form-label">Fecha de nacimiento</label>
                                <input type="date" class="form-control" id="fechaNacimientoStr" name="fechaNacimientoStr"
                                       th:value="${fechaNacimientoStr}" required>
                                <div class="invalid-feedback">Por favor seleccione una fecha de nacimiento válida</div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="sexo" class="form-label">Sexo</label>
                                <select class="form-select" id="sexo" th:field="*{sexo}" required>
                                    <option value="">-- Seleccione sexo --</option>
                                    <option value="Macho">Macho</option>
                                    <option value="Hembra">Hembra</option>
                                </select>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('sexo')}" th:errors="*{sexo}">Error en el sexo</div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <a th:href="@{/mascotas}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Guardar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<div th:replace="fragments/footer :: footer"></div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script th:inline="javascript">
    $(document).ready(function() {
        // Inicializar el selector de fecha
        flatpickr("#fechaNacimientoStr", {
            dateFormat: "Y-m-d",
            maxDate: "today", // No permite fechas futuras
            locale: {
                firstDayOfWeek: 1,
                weekdays: {
                    shorthand: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'Sa'],
                    longhand: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado']
                },
                months: {
                    shorthand: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                    longhand: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre']
                }
            }
        });

        // Validación del formulario al enviar
        $('form').submit(function(event) {
            var isValid = true;

            // Validar nombre
            if ($('#nombre').val().trim() === '') {
                $('#nombre').addClass('is-invalid');
                isValid = false;
            } else {
                $('#nombre').removeClass('is-invalid');
            }

            // Validar especie
            if ($('#especie').val() === '') {
                $('#especie').addClass('is-invalid');
                isValid = false;
            } else {
                $('#especie').removeClass('is-invalid');
            }

            // Validar fecha de nacimiento
            if ($('#fechaNacimientoStr').val() === '') {
                $('#fechaNacimientoStr').addClass('is-invalid');
                isValid = false;
            } else {
                $('#fechaNacimientoStr').removeClass('is-invalid');
            }

            // Validar sexo
            if ($('#sexo').val() === '') {
                $('#sexo').addClass('is-invalid');
                isValid = false;
            } else {
                $('#sexo').removeClass('is-invalid');
            }

            if (!isValid) {
                event.preventDefault();
            }
        });
    });
</script>
</body>
</html>